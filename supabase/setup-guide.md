# Supabase è®¾ç½®æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

æœ¬æŒ‡å—å°†å¸®åŠ©æ‚¨è®¾ç½® Supabase é¡¹ç›®ï¼ŒåŒ…æ‹¬ï¼š
1. åˆ›å»º Supabase é¡¹ç›®
2. æ‰§è¡Œæ•°æ®åº“ Schema
3. é…ç½®èº«ä»½éªŒè¯
4. è®¾ç½®ç¯å¢ƒå˜é‡

---

## ğŸš€ ç¬¬ä¸€æ­¥ï¼šåˆ›å»º Supabase é¡¹ç›®

### 1. æ³¨å†Œ/ç™»å½• Supabase

è®¿é—® [https://supabase.com](https://supabase.com) å¹¶æ³¨å†Œæˆ–ç™»å½•ã€‚

### 2. åˆ›å»ºæ–°é¡¹ç›®

1. ç‚¹å‡» **"New Project"**
2. å¡«å†™é¡¹ç›®ä¿¡æ¯ï¼š
   - **Name**: `society-security-calculator` (æˆ–æ‚¨å–œæ¬¢çš„åç§°)
   - **Database Password**: è®¾ç½®ä¸€ä¸ªå¼ºå¯†ç ï¼ˆè¯·ä¿å­˜å¥½ï¼‰
   - **Region**: é€‰æ‹©è·ç¦»æ‚¨æœ€è¿‘çš„åŒºåŸŸï¼ˆå¦‚ `Southeast Asia (Singapore)`ï¼‰
3. ç‚¹å‡» **"Create new project**"
4. ç­‰å¾…é¡¹ç›®åˆ›å»ºå®Œæˆï¼ˆçº¦ 2-3 åˆ†é’Ÿï¼‰

---

## ğŸ—„ï¸ ç¬¬äºŒæ­¥ï¼šæ‰§è¡Œæ•°æ®åº“ Schema

### æ–¹æ³•ä¸€ï¼šé€šè¿‡ Supabase Dashboardï¼ˆæ¨èæ–°æ‰‹ï¼‰

1. åœ¨ Supabase Dashboard ä¸­ï¼Œç‚¹å‡»å·¦ä¾§èœå•çš„ **SQL Editor**
2. ç‚¹å‡» **"New query"**
3. æ‰“å¼€é¡¹ç›®ä¸­çš„ `supabase/schema.sql` æ–‡ä»¶
4. å¤åˆ¶æ‰€æœ‰ SQL ä»£ç 
5. ç²˜è´´åˆ° SQL Editor ä¸­
6. ç‚¹å‡» **"Run"** æŒ‰é’®æ‰§è¡Œ
7. ç­‰å¾…æ‰§è¡Œå®Œæˆï¼Œç¡®è®¤æ‰€æœ‰è¡¨éƒ½å·²åˆ›å»º

### æ–¹æ³•äºŒï¼šé€šè¿‡ CLIï¼ˆæ¨èè¿›é˜¶ç”¨æˆ·ï¼‰

```bash
# å®‰è£… Supabase CLI (å¦‚æœå°šæœªå®‰è£…)
npm install -g supabase

# ç™»å½• Supabase
supabase login

# é“¾æ¥åˆ°æ‚¨çš„é¡¹ç›®
supabase link --project-ref <your-project-ref>

# æ‰§è¡Œ schema.sql
supabase db push --db-url "postgresql://postgres:[YOUR-PASSWORD]@db.[YOUR-PROJECT-REF].supabase.co:5432/postgres" --schema supabase/schema.sql
```

### éªŒè¯è¡¨åˆ›å»º

æ‰§è¡Œå®Œæˆåï¼Œåœ¨ Supabase Dashboard ä¸­ï¼š
1. ç‚¹å‡»å·¦ä¾§èœå•çš„ **Table Editor**
2. åº”è¯¥èƒ½çœ‹åˆ°ä»¥ä¸‹è¡¨ï¼š
   - `cities` - åŸå¸‚ç¤¾ä¿æ ‡å‡†
   - `salaries` - å‘˜å·¥å·¥èµ„æ•°æ®
   - `results` - è®¡ç®—ç»“æœ
   - `upload_tasks` - ä¸Šä¼ ä»»åŠ¡
   - `calculation_tasks` - è®¡ç®—ä»»åŠ¡
   - `user_settings` - ç”¨æˆ·è®¾ç½®
   - `audit_logs` - å®¡è®¡æ—¥å¿—

---

## ğŸ” ç¬¬ä¸‰æ­¥ï¼šé…ç½®èº«ä»½éªŒè¯

### 1. å¯ç”¨ Email Auth

Supabase é»˜è®¤å·²å¯ç”¨ Email èº«ä»½éªŒè¯ï¼Œæ— éœ€é¢å¤–é…ç½®ã€‚

### 2. é…ç½®é‚®ä»¶è®¾ç½®ï¼ˆå¯é€‰ï¼‰

**å¼€å‘é˜¶æ®µ**ï¼šSupabase ä¼šè‡ªåŠ¨å‘é€é‚®ä»¶åˆ°æ‚¨çš„æ”¶ä»¶ç®±ã€‚

**ç”Ÿäº§ç¯å¢ƒ**ï¼šå»ºè®®é…ç½®è‡ªå®šä¹‰ SMTP æœåŠ¡å™¨ï¼š
1. åœ¨ Dashboard ä¸­ï¼Œè¿›å…¥ **Authentication** â†’ **Email Templates**
2. é…ç½®ç¡®è®¤é‚®ä»¶æ¨¡æ¿
3. è¿›å…¥ **Project Settings** â†’ **Auth** â†’ **SMTP Settings**
4. å¡«å†™æ‚¨çš„ SMTP æœåŠ¡å™¨ä¿¡æ¯

### 3. ç¦ç”¨ Email ç¡®è®¤ï¼ˆä»…å¼€å‘ç¯å¢ƒï¼‰

**âš ï¸ ä»…ç”¨äºå¼€å‘ï¼Œç”Ÿäº§ç¯å¢ƒè¯·å¯ç”¨ç¡®è®¤ï¼**

1. åœ¨ Dashboard ä¸­ï¼Œè¿›å…¥ **Authentication** â†’ **Providers**
2. ç‚¹å‡» **Email** æä¾›å•†
3. å°† **Confirm email** è®¾ç½®ä¸º **OFF**
4. ç‚¹å‡» **Save**

è¿™æ ·ç”¨æˆ·æ³¨å†Œåæ— éœ€é‚®ä»¶ç¡®è®¤å³å¯ç™»å½•ã€‚

---

## ğŸ”‘ ç¬¬å››æ­¥ï¼šè·å– API å¯†é’¥

1. åœ¨ Supabase Dashboard ä¸­ï¼Œç‚¹å‡»å·¦ä¾§èœå•çš„ **Project Settings** (é½¿è½®å›¾æ ‡)
2. ç‚¹å‡» **API**
3. å¤åˆ¶ä»¥ä¸‹ä¿¡æ¯ï¼š
   - **Project URL**: ç±»ä¼¼ `https://xxxxx.supabase.co`
   - **anon public**: åŒ¿åå…¬é’¥ï¼ˆä»¥å‰ç§°ä¸º `anon key`ï¼‰
   - **service_role**: æœåŠ¡è§’è‰²å¯†é’¥ï¼ˆä»…ç”¨äºæœåŠ¡å™¨ç«¯ï¼‰

âš ï¸ **é‡è¦æç¤º**ï¼š
- `anon` key ç”¨äºå®¢æˆ·ç«¯ï¼ˆæµè§ˆå™¨ï¼‰
- `service_role` key å¯ä»¥ç»•è¿‡ RLSï¼Œ**æ°¸è¿œä¸è¦æš´éœ²ç»™å®¢æˆ·ç«¯**

---

## âš™ï¸ ç¬¬äº”æ­¥ï¼šé…ç½®ç¯å¢ƒå˜é‡

### 1. åˆ›å»º `.env.local` æ–‡ä»¶

åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º `.env.local` æ–‡ä»¶ï¼š

```bash
# Supabase é…ç½®
NEXT_PUBLIC_SUPABASE_URL=https://your-project.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=your-anon-key-here
SUPABASE_SERVICE_ROLE_KEY=your-service-role-key-here

# å¼€å‘ç¯å¢ƒé…ç½®
NODE_ENV=development
```

### 2. æ›¿æ¢å ä½ç¬¦

å°†ä»ä¸Šä¸€æ­¥è·å–çš„å€¼æ›¿æ¢åˆ° `.env.local` æ–‡ä»¶ä¸­ã€‚

### 3. éªŒè¯ç¯å¢ƒå˜é‡

è¿è¡Œä»¥ä¸‹å‘½ä»¤éªŒè¯é…ç½®ï¼š

```bash
npm run dev
```

å¦‚æœæ§åˆ¶å°æ²¡æœ‰æŠ¥é”™ï¼Œè¯´æ˜é…ç½®æˆåŠŸï¼

---

## ğŸ§ª ç¬¬å…­æ­¥ï¼šæµ‹è¯•æ•°æ®åº“è¿æ¥

### 1. è¿è¡Œè¿æ¥æµ‹è¯•

```bash
node src/lib/test-connection.js
```

æˆ–è€…é€šè¿‡æµè§ˆå™¨è®¿é—®ï¼š
```
http://localhost:3000/api/test-db
```

### 2. é¢„æœŸç»“æœ

æˆåŠŸè¾“å‡ºï¼š
```json
{
  "success": true,
  "message": "æ•°æ®åº“è¿æ¥æˆåŠŸï¼",
  "data": {
    "cities": 1,
    "salaries": 0,
    "results": 0
  }
}
```

---

## ğŸ“Š ç¬¬ä¸ƒæ­¥ï¼šéªŒè¯åˆå§‹æ•°æ®

### 1. æ£€æŸ¥åŸå¸‚æ•°æ®

åœ¨ Supabase Dashboard çš„ **Table Editor** ä¸­ï¼š
1. ç‚¹å‡» `cities` è¡¨
2. åº”è¯¥èƒ½çœ‹åˆ°ä¸€æ¡è®°å½•ï¼š
   - `city_name`: "ä½›å±±"
   - `year`: 2025
   - `base_min`: 1900
   - `base_max`: 28002

### 2. æµ‹è¯•è®¡ç®—å‡½æ•°

åœ¨ SQL Editor ä¸­è¿è¡Œï¼š

```sql
SELECT * FROM calculate_monthly_contribution(5000, 'ä½›å±±', 2025);
```

åº”è¯¥è¿”å›è®¡ç®—ç»“æœï¼Œæ˜¾ç¤ºå„é¡¹ä¿é™©é‡‘é¢ã€‚

---

## ğŸš¨ å¸¸è§é—®é¢˜

### é—®é¢˜ 1ï¼šè¿æ¥è¶…æ—¶

**è§£å†³æ–¹æ¡ˆ**ï¼š
- æ£€æŸ¥ `.env.local` ä¸­çš„ URL æ˜¯å¦æ­£ç¡®
- ç¡®è®¤ Supabase é¡¹ç›®æ˜¯å¦å¤„äº **Active** çŠ¶æ€
- å°è¯•é‡å¯å¼€å‘æœåŠ¡å™¨ï¼š`npm run dev`

### é—®é¢˜ 2ï¼šæƒé™é”™è¯¯ (RLS)

**è§£å†³æ–¹æ¡ˆ**ï¼š
- ç¡®ä¿å·²æ‰§è¡Œå®Œæ•´çš„ schema.sqlï¼ˆåŒ…å« RLS ç­–ç•¥ï¼‰
- æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²ç™»å½•
- åœ¨ SQL Editor ä¸­è¿è¡Œï¼š`SELECT * FROM auth.users;`

### é—®é¢˜ 3ï¼šè¡¨ä¸å­˜åœ¨

**è§£å†³æ–¹æ¡ˆ**ï¼š
- é‡æ–°æ‰§è¡Œ schema.sql
- æ£€æŸ¥ Table Editor æ˜¯å¦æ˜¾ç¤ºæ‰€æœ‰è¡¨
- æŸ¥çœ‹æ‰§è¡Œæ—¥å¿—æ˜¯å¦æœ‰é”™è¯¯

### é—®é¢˜ 4ï¼šæ— æ³•æ³¨å†Œç”¨æˆ·

**è§£å†³æ–¹æ¡ˆ**ï¼š
- æ£€æŸ¥ Email Auth æ˜¯å¦å·²å¯ç”¨
- å¦‚æœç¦ç”¨äº†ç¡®è®¤é‚®ä»¶ï¼Œç¡®ä¿è®¾ç½®æ­£ç¡®
- æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°çš„é”™è¯¯ä¿¡æ¯

---

## ğŸ” å®‰å…¨å»ºè®®

1. **æ°¸è¿œä¸è¦æäº¤ `.env.local` åˆ° Git**
   ```bash
   # ç¡®ä¿ .gitignore åŒ…å«ï¼š
   .env.local
   .env*.local
   ```

2. **ä½¿ç”¨ç¯å¢ƒå˜é‡ç®¡ç†æ•æ„Ÿä¿¡æ¯**
   - ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ Vercel/Netlify çš„ç¯å¢ƒå˜é‡è®¾ç½®
   - å¼€å‘ç¯å¢ƒä½¿ç”¨ `.env.local`

3. **ä¿æŠ¤ Service Role Key**
   - ä»…åœ¨ API è·¯ç”±ä¸­ä½¿ç”¨
   - æ°¸è¿œä¸è¦åœ¨å®¢æˆ·ç«¯ä»£ç ä¸­ä½¿ç”¨

4. **å¯ç”¨ Row Level Security (RLS)**
   - Schema.sql å·²åŒ…å« RLS ç­–ç•¥
   - ç¡®ä¿æ‰€æœ‰è¡¨éƒ½æœ‰é€‚å½“çš„ç­–ç•¥

---

## ğŸ“š ä¸‹ä¸€æ­¥

å®Œæˆ Supabase è®¾ç½®åï¼Œæ‚¨å¯ä»¥ï¼š

1. âœ… **æµ‹è¯•è®¤è¯åŠŸèƒ½**
   - è®¿é—® `http://localhost:3000/register`
   - æ³¨å†Œä¸€ä¸ªæµ‹è¯•è´¦æˆ·
   - ç™»å½•å¹¶éªŒè¯

2. ğŸ“Š **ä¸Šä¼ æµ‹è¯•æ•°æ®**
   - è®¿é—®ä¸»é¡µ
   - ä¸Šä¼  Excel æ–‡ä»¶

3. ğŸ§® **æ‰§è¡Œè®¡ç®—**
   - æŸ¥çœ‹è®¡ç®—ç»“æœ
   - å¯¼å‡ºæ•°æ®

---

## ğŸ†˜ éœ€è¦å¸®åŠ©ï¼Ÿ

- [Supabase å®˜æ–¹æ–‡æ¡£](https://supabase.com/docs)
- [Supabase Discord ç¤¾åŒº](https://discord.gg/supabase)
- [é¡¹ç›® GitHub Issues](https://github.com/your-repo/issues)

---

**åˆ›å»ºæ—¶é—´**: 2025-12-23
**ç‰ˆæœ¬**: v0.1.0
